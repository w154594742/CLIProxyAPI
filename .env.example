# ============================================================================
# CLIProxyAPI 环境变量配置文件
# ============================================================================
# 说明:
# 1. 配置分为两类:
#    a) 敏感配置 (🔒): 环境变量始终优先,防止被 Web 管理界面修改覆盖
#    b) 运行时配置 (⚙️): 仅初始化时使用,允许通过 Web 界面持久化修改
# 2. 复制此文件为 .env 并修改相应配置
# 3. 未设置的环境变量将使用 config.yaml 中的默认值
# 4. Docker Compose 会自动加载 .env 文件
#
# 作者: wangqiupei
# 项目: CLIProxyAPI
# ============================================================================

# ----------------------------------------------------------------------------
# 🔒 服务器配置 (敏感 - 环境变量始终优先)
# ----------------------------------------------------------------------------
# 服务器绑定地址
# 默认: "" (绑定所有接口 IPv4 + IPv6)
# 本地测试: "127.0.0.1" 或 "localhost"
# 生产环境: "" 或 "0.0.0.0"
# 注意: 此配置涉及网络安全边界,不可通过 Web 界面修改
# SERVER_HOST=

# 服务器监听端口
# 默认: 8317
# 注意: 此配置涉及网络安全边界,不可通过 Web 界面修改
SERVER_PORT=8317

# ----------------------------------------------------------------------------
# 🔒 TLS/HTTPS 配置 (敏感 - 环境变量始终优先)
# ----------------------------------------------------------------------------
# 是否启用 HTTPS
# 值: true/false, 1/0, yes/no, on/off, enabled/disabled
# 注意: 传输层安全配置,不可通过 Web 界面修改
TLS_ENABLE=false

# TLS 证书文件路径 (启用 HTTPS 时必需)
# 例如: /path/to/cert.pem
# 注意: 证书路径涉及安全,不可通过 Web 界面修改
# TLS_CERT_FILE=

# TLS 私钥文件路径 (启用 HTTPS 时必需)
# 例如: /path/to/key.pem
# 注意: 私钥路径涉及安全,不可通过 Web 界面修改
# TLS_KEY_FILE=

# ----------------------------------------------------------------------------
# 🔒 管理 API 配置 (敏感 - 环境变量始终优先)
# ----------------------------------------------------------------------------
# 是否允许远程访问管理 API
# false: 仅 localhost 可访问 (推荐)
# true: 允许远程访问 (需配合强密钥使用)
# 注意: 访问控制配置,不可通过 Web 界面修改
MANAGEMENT_ALLOW_REMOTE=false

# 管理 API 密钥 (必须修改!)
# 支持格式:
#   1. 明文密码 (启动时自动哈希): change-me-to-a-strong-password
#   2. BCrypt 哈希值 (预先生成): $2a$10$...
# 重要: 生产环境必须使用强密码!
# 注意: 管理密钥始终从环境变量读取,防止被 Web 界面修改
MANAGEMENT_SECRET_KEY=change-me-to-a-strong-password

# 是否禁用管理控制面板
# true: 禁用 Web 管理界面
# false: 启用 Web 管理界面
# 注意: 安全配置,不可通过 Web 界面修改
MANAGEMENT_DISABLE_PANEL=false

# ----------------------------------------------------------------------------
# 🔒 认证与存储配置 (敏感 - 环境变量始终优先)
# ----------------------------------------------------------------------------
# OAuth 认证文件存储目录
# Docker 环境默认: /root/.cli-proxy-api
# 本地开发默认: ~/.cli-proxy-api
# 注意: 存储路径涉及安全,不可通过 Web 界面修改
AUTH_DIR=/root/.cli-proxy-api

# ----------------------------------------------------------------------------
# PostgreSQL Token Store (可选 - 多实例共享状态)
# ----------------------------------------------------------------------------
# PostgreSQL 数据库连接字符串
# 格式: postgresql://username:password@host:port/database
# 启用后将使用 PostgreSQL 存储 token,支持多实例部署
# PGSTORE_DSN=postgresql://user:pass@localhost:5432/cliproxy

# PostgreSQL schema 名称
# 默认: public
# PGSTORE_SCHEMA=public

# 本地备份路径 (可选)
# PGSTORE_LOCAL_PATH=/var/lib/cliproxy

# ----------------------------------------------------------------------------
# Git-Backed Config Store (可选 - 配置版本控制)
# ----------------------------------------------------------------------------
# Git 仓库 URL
# 启用后将使用 Git 仓库存储和同步配置
# GITSTORE_GIT_URL=https://github.com/your-org/cli-proxy-config.git

# Git 用户名
# GITSTORE_GIT_USERNAME=git-user

# Git 访问令牌 (Personal Access Token)
# GitHub: Settings -> Developer settings -> Personal access tokens
# GITSTORE_GIT_TOKEN=ghp_your_personal_access_token

# Git 本地仓库路径
# GITSTORE_LOCAL_PATH=/data/cliproxy/gitstore

# ----------------------------------------------------------------------------
# Object Store (S3/Minio) Token Store (可选 - 云存储)
# ----------------------------------------------------------------------------
# S3 兼容对象存储端点
# 例如: https://s3.amazonaws.com, https://minio.example.com
# OBJECTSTORE_ENDPOINT=https://s3.your-cloud.example.com

# 存储桶名称
# OBJECTSTORE_BUCKET=cli-proxy-config

# 访问密钥 ID (Access Key)
# OBJECTSTORE_ACCESS_KEY=your_access_key

# 访问密钥密文 (Secret Key)
# OBJECTSTORE_SECRET_KEY=your_secret_key

# 本地缓存路径 (可选)
# OBJECTSTORE_LOCAL_PATH=/data/cliproxy/objectstore

# ----------------------------------------------------------------------------
# ⚙️ 日志与调试配置 (运行时可调整 - 支持 Web 界面修改)
# ----------------------------------------------------------------------------
# 是否启用 DEBUG 日志
# true: 输出详细调试信息
# false: 仅输出 INFO 及以上级别日志
# 注意: 可通过 Web 界面动态调整
DEBUG=false

# 是否将日志写入文件
# true: 日志写入 ./logs 目录 (滚动日志文件)
# false: 日志输出到 stdout (适合容器环境)
# 注意: 可通过 Web 界面动态调整
LOGGING_TO_FILE=true

# 是否启用使用统计
# true: 收集并聚合使用统计数据
# false: 不收集统计数据
# 注意: 可通过 Web 界面动态调整
USAGE_STATISTICS_ENABLED=true

# ----------------------------------------------------------------------------
# ⚙️ 网络配置 (运行时可调整 - 支持 Web 界面修改)
# ----------------------------------------------------------------------------
# HTTP/SOCKS5 代理地址
# 格式:
#   - HTTP: http://127.0.0.1:7890
#   - HTTPS: https://proxy.example.com:8080
#   - SOCKS5: socks5://user:pass@192.168.1.1:1080
# 留空则不使用代理
# 注意: 可通过 Web 界面动态修改,环境变量仅在首次部署时生效
# PROXY_URL=

# 请求失败重试次数
# 适用于 HTTP 状态码: 403, 408, 500, 502, 503, 504
# 默认: 3
# 注意: 可通过 Web 界面动态修改,环境变量仅在首次部署时生效
REQUEST_RETRY=3

# 最大重试等待时间 (秒)
# 冷却凭证的最大等待时间
# 默认: 30
# 注意: 可通过 Web 界面动态修改,环境变量仅在首次部署时生效
MAX_RETRY_INTERVAL=30

# ----------------------------------------------------------------------------
# 🔒 功能开关配置 (敏感 - 环境变量始终优先)
# ----------------------------------------------------------------------------
# WebSocket API 是否需要认证
# true: /v1/ws 端点需要 API Key 认证
# false: WebSocket 无需认证 (不推荐生产环境)
# 注意: API 安全配置,不可通过 Web 界面修改
WS_AUTH=false

# ----------------------------------------------------------------------------
# ⚙️ 功能开关配置 (运行时可调整 - 支持 Web 界面修改)
# ----------------------------------------------------------------------------
# 是否禁用配额冷却机制
# true: 禁用自动冷却调度
# false: 启用配额冷却 (推荐)
# 注意: 可通过 Web 界面动态调整
DISABLE_COOLING=false

# 云部署模式
# 设置为 "cloud" 启用云部署特性
# 留空则使用标准模式
# DEPLOY=

# ----------------------------------------------------------------------------
# ⚙️ 配额超限行为配置 (运行时可调整 - 支持 Web 界面修改)
# ----------------------------------------------------------------------------
# 配额超限时是否自动切换项目
# true: 自动切换到其他可用项目
# false: 不自动切换
# 注意: 可通过 Web 界面动态调整
# QUOTA_SWITCH_PROJECT=true

# 配额超限时是否自动切换到预览模型
# true: 自动降级到预览版模型
# false: 不自动切换
# 注意: 可通过 Web 界面动态调整
# QUOTA_SWITCH_PREVIEW_MODEL=true

# ----------------------------------------------------------------------------
# ⚙️ Amp CLI 集成配置 (运行时可调整 - 支持 Web 界面修改)
# ----------------------------------------------------------------------------
# Amp 上游控制平面 URL
# 用于 Amp CLI 的 OAuth 和管理功能
# 例如: https://ampcode.com
# 注意: 可通过 Web 界面动态修改,环境变量仅在首次部署时生效
# AMP_UPSTREAM_URL=

# Amp 上游 API 密钥 (可选覆盖)
# 留空则使用环境变量或文件中的密钥
# 注意: 可通过 Web 界面动态修改,环境变量仅在首次部署时生效
# AMP_UPSTREAM_API_KEY=

# 是否将 Amp 管理路由限制为仅本地访问
# true: /api/auth, /api/user 等仅允许 localhost
# false: 允许远程访问 (默认,依赖 API Key 认证)
# 注意: 可通过 Web 界面动态调整
# AMP_RESTRICT_MANAGEMENT_TO_LOCALHOST=false

# 是否强制优先使用模型映射
# true: 模型映射优先于本地 API Key
# false: 优先使用本地 API Key (默认)
# 注意: 可通过 Web 界面动态调整
# AMP_FORCE_MODEL_MAPPINGS=false

# ----------------------------------------------------------------------------
# 配置策略说明
# ----------------------------------------------------------------------------
# 配置分为两类,优先级策略不同:
#
# 🔒 敏感配置 (环境变量始终优先):
#   - SERVER_HOST, SERVER_PORT          : 网络安全边界
#   - TLS_*                             : 传输层安全
#   - MANAGEMENT_*                      : 访问控制
#   - AUTH_DIR                          : 存储路径
#   - WS_AUTH                           : API 安全
#   特点: 这些配置在 Web 管理界面中显示为"只读",不可修改
#         环境变量会在每次启动时强制覆盖配置文件中的值
#         适合需要严格安全控制的生产环境
#
# ⚙️ 运行时配置 (支持 Web 界面修改):
#   - DEBUG, LOGGING_TO_FILE            : 日志配置
#   - PROXY_URL, REQUEST_RETRY          : 网络配置
#   - DISABLE_COOLING, QUOTA_*          : 功能开关
#   - AMP_*                             : Amp 集成
#   特点: 环境变量仅在首次部署或配置文件中为空时生效
#         启动后可通过 Web 管理界面动态修改并持久化
#         修改后重启服务不会被环境变量覆盖
#         适合需要运行时调整的配置项
#
# 管理员密码修改方法:
# 1. 修改此文件中的 MANAGEMENT_SECRET_KEY
# 2. 重启服务: docker-compose restart
# 注意: 管理员密码始终从环境变量读取,Web 界面无法修改
#
# 配置管理最佳实践:
# - 生产环境:
#   * 敏感信息 (密码、密钥、证书): 使用环境变量
#   * 结构化配置 (API Key 列表、模型映射): 保留在 config.yaml
#   * 运行时配置: 首次部署用环境变量初始化,后续通过 Web 界面调整
# - 开发环境:
#   * 直接修改 config.yaml 进行快速测试
#   * .env 文件留空或仅覆盖必要项
#
# Docker 部署注意事项:
# - Docker Compose 会自动加载同目录下的 .env 文件
# - 容器内路径与宿主机不同,注意卷挂载配置
# - 环境变量中的路径应使用容器内路径 (如 AUTH_DIR=/root/.cli-proxy-api)
# ============================================================================
